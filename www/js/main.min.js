/*! danielepelagatti.com 2014-03-28 */
THREE.PlaneShader={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.common,{wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},emissive:{type:"c",value:new THREE.Color(0)},ambient:{type:"c",value:new THREE.Color(16777215)},opacity:{type:"f",value:-1},focused_map:{type:"t",value:null},focus_balance:{type:"f",value:-1},overlay_map:{type:"t",value:null},ovelay_unfocused_alpha:{type:"f",value:-1},diffuse:{type:"v3",value:new THREE.Vector3(0,0,0)}}]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;",THREE.ShaderChunk.map_pars_fragment,"uniform sampler2D focused_map;","uniform float focus_balance;","uniform sampler2D overlay_map;","uniform float ovelay_unfocused_alpha;","uniform vec3 diffuse;","void main() {","	vec3 white = vec3( 1.0 );","	gl_FragColor = vec4( mix( diffuse, white , clamp(ovelay_unfocused_alpha + focus_balance,0.0,1.0) )  , (1.0 - focus_balance) );","	#ifdef USE_MAP","		vec4 texelColor = texture2D( map, vUv );","		vec4 focusedColor = texture2D( focused_map, vUv );","		vec4 finalColor = mix(texelColor,focusedColor,focus_balance);","		// #ifdef GAMMA_INPUT","		// finalColor.xyz *= finalColor.xyz;","		// #endif","		gl_FragColor = gl_FragColor * finalColor;","	#endif","	// overlay an image","	// vec4 overlay = texture2D( overlay_map , vUv );","	// vec3 mixed = mix( white, overlay.xyz, clamp(ovelay_unfocused_alpha + focus_balance,0.0,1.0) );","	// gl_FragColor.xyz *= ( mixed );",THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(){this.cleanupPathName=b(this.cleanupPathName,this),this.getRelativeLink=b(this.getRelativeLink,this),this.getUpDirs=b(this.getUpDirs,this),this.handlePicking=b(this.handlePicking,this),this.render=b(this.render,this),this.animate=b(this.animate,this),this.onMouseMove=b(this.onMouseMove,this),this.onWindowResize=b(this.onWindowResize,this),this.unfocus=b(this.unfocus,this),this.getFocusedPagePosition=b(this.getFocusedPagePosition,this),this.focus=b(this.focus,this),this.handleFocus=b(this.handleFocus,this),this.sceneLoadCallback=b(this.sceneLoadCallback,this),this.hideLoading=b(this.hideLoading,this),this.showLoading=b(this.showLoading,this),this.setupCSS3DPage=b(this.setupCSS3DPage,this),this.onConfigError=b(this.onConfigError,this),this.onMenuLinkOut=b(this.onMenuLinkOut,this),this.handlePushState=b(this.handlePushState,this),this.on3DSceneMouseClick=b(this.on3DSceneMouseClick,this),this.onMenuLinkClick=b(this.onMenuLinkClick,this),this.onMenuLinkOver=b(this.onMenuLinkOver,this),this.onPopStateChange=b(this.onPopStateChange,this),this.onCloseClick=b(this.onCloseClick,this),this.onConfigLoaded=b(this.onConfigLoaded,this);var a;a=!!window.MSInputMethodContext,this.checkWebGL()&&-1===window.navigator.userAgent.indexOf("MSIE ")&&!a?(this.htmlMain=$("main"),this.htmlMain.remove(),$("body").css("overflow-y","hidden"),$.ajax(this.pageBase+"config.json",{success:this.onConfigLoaded,error:this.onConfigError}),ga("send","event","webgl-test","passed")):ga("send","event","webgl-test","failed")}return a.prototype.CONTAINER_X=200,a.prototype.SCREEN_WIDTH=window.innerWidth-a.CONTAINER_X,a.prototype.SCREEN_HEIGHT=window.innerHeight,a.prototype.FLOOR=-50,a.prototype.TRANSITION_DURATION=.5,a.prototype.PAGE_SCALE_MULTIPLIER=.1,a.prototype.SCENE_SCALE_MULTIPLIER=100,a.prototype.CSS3D_SCALE_MULTIPLIER=1,a.prototype.container=null,a.prototype.camera=null,a.prototype.scene=null,a.prototype.css3DScene=null,a.prototype.webglRenderer=null,a.prototype.css3dRenderer=null,a.prototype.mouseX=0,a.prototype.mouseY=0,a.prototype.pickMouseX=0,a.prototype.pickMouseY=0,a.prototype.windowHalfX=a.SCREEN_WIDTH/2,a.prototype.windowHalfY=a.SCREEN_HEIGHT/2,a.prototype.has_gl=!1,a.prototype.projector=null,a.prototype.raycaster=null,a.prototype.overObject=null,a.prototype.excludeFromPicking=["scene_baked_pPlane1"],a.prototype.initialObjectsProperties={},a.prototype.clickedObject=null,a.prototype.clickedObjectWPosition=null,a.prototype.clickedObjectWRotation=null,a.prototype.clickedObjectWScale=null,a.prototype.isFocused=!1,a.prototype.pageLanguage=window.PAGE_LANG,a.prototype.pagePermalink=window.PAGE_PERMALINK,a.prototype.pageDepth=window.PAGE_DEPTH,a.prototype.pageBase=window.PAGE_BASE,a.prototype.pageId="",a.prototype.config=[],a.prototype.allLanguagesConfig=[],a.prototype.thisPageConfig=null,a.prototype.page3DObjects={},a.prototype.doPicking=!0,a.prototype.currentHistoryState={},a.prototype.cameraLookAt=new THREE.Vector3(-50,-300,0),a.prototype.htmlMain=null,a.prototype.delayID=-1,a.prototype.checkWebGL=function(){var a,b;b=navigator.userAgent.toLowerCase(),a=/android/.test(b)&&!/chrome/.test(b);try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")&&!a}catch(c){return!1}},a.prototype.onConfigLoaded=function(a){if(this.container=$(".javascriptContent"),this.CONTAINER_X=this.container.position().left,this.SCREEN_WIDTH=window.innerWidth-this.CONTAINER_X,this.SCREEN_HEIGHT=window.innerHeight,this.windowHalfX=this.SCREEN_WIDTH/2,this.windowHalfY=this.SCREEN_HEIGHT/2,this.allLanguagesConfig=a,this.config=a[this.pageLanguage],null==this.config)throw"Cannot find config for this language";return this.init(),this.animate(),$(".projectsMenu").find("a").mouseover(this.onMenuLinkOver),$(".projectsMenu").find("a").mouseout(this.onMenuLinkOut),$(".projectsMenu").find("a").click(this.onMenuLinkClick),$(".close-page").click(this.onCloseClick),$(window).bind("popstate",this.onPopStateChange),null},a.prototype.onCloseClick=function(){return ga("send","event","close-page-button","click"),this.unfocus()},a.prototype.onPopStateChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(null!=a.originalEvent.state){for(e=a.originalEvent.state.path,r=this.config,j=0,n=r.length;n>j;j++)if(g=r[j],g.link===e){this.pageId=g.meta.id,this.thisPageConfig=g;break}for(this.pageLanguage=this.thisPageConfig.lang,this.pagePermalink=this.thisPageConfig.meta.permalink,this.pageDepth=this.thisPageConfig.depth,this.pageBase=this.thisPageConfig.base,document.title="Daniele Pelagatti - "+this.thisPageConfig.meta.title,f=this.page3DObjects[e],this.isFocused?this.clickedObject!==f&&(this.doPicking=!1,this.overObject=null,this.handleFocus(),-1!==this.delayID&&clearTimeout(this.delayID),this.delayID=_.delay(function(a){return function(){return a.overObject=f,a.isFocused=!1,a.handleFocus(),a.doPicking=!0}}(this),1e3*this.TRANSITION_DURATION+100)):(this.overObject=f,this.handleFocus()),d=$(".languagesMenu").find("a"),k=0,o=d.length;o>k;k++)for(c=d[k],b=this.allLanguagesConfig[c.id],l=0,p=b.length;p>l;l++)g=b[l],g.meta.id===this.pageId&&$(c).attr("href",this.getRelativeLink(g.link));for(i=$(".projectsMenu").find("a"),m=0,q=i.length;q>m;m++)h=i[m],$(h).attr("permalink")===this.currentHistoryState?$(h).addClass("selected"):$(h).removeClass("selected"),$(h).attr("href",this.pageBase+this.getRelativeLink($(h).attr("permalink")).substr(1));return ga("send","pageview",this.thisPageConfig.link),null}},a.prototype.onMenuLinkOver=function(a){var b;return b=this.page3DObjects[$(a.currentTarget).attr("permalink")],this.doPicking=!1,this.handlePicking(b),null},a.prototype.onMenuLinkClick=function(a){return a.originalEvent.preventDefault(),this.handlePushState($(a.currentTarget).attr("permalink"))},a.prototype.on3DSceneMouseClick=function(){return null==this.overObject?(this.handleFocus(),void ga("send","event","3d-empty-space","click")):(ga("send","event","3d-plane:"+this.overObject.link,"click"),this.handlePushState(this.overObject.link))},a.prototype.handlePushState=function(a){var b;return b={path:a},a!==this.currentHistoryState&&(history.pushState(b,"Title",this.pageBase+a.substr(1)),this.currentHistoryState=a),this.onPopStateChange({originalEvent:{state:b}})},a.prototype.onMenuLinkOut=function(){return this.doPicking=!0,null},a.prototype.onConfigError=function(){},a.prototype.init=function(){var a;this.camera=new THREE.PerspectiveCamera(75,this.SCREEN_WIDTH/this.SCREEN_HEIGHT,1,1e4),this.camera.position.z=300,this.scene=new THREE.Scene,this.css3DScene=new THREE.Scene,this.css3DScene.scale.set(this.CSS3D_SCALE_MULTIPLIER,this.CSS3D_SCALE_MULTIPLIER,this.CSS3D_SCALE_MULTIPLIER),this.css3DScene.updateMatrix();try{this.webglRenderer=new THREE.WebGLRenderer({antialias:!0}),this.webglRenderer.setClearColor(16777215),this.webglRenderer.setSize(this.SCREEN_WIDTH,this.SCREEN_HEIGHT),this.webglRenderer.domElement.style.position="relative",$(this.webglRenderer.domElement).addClass("threejs-container"),this.container.append(this.webglRenderer.domElement),this.has_gl=!0}catch(b){}return this.css3dRenderer=new THREE.CSS3DRenderer,this.css3dRenderer.setClearColor(16777215),this.css3dRenderer.setSize(this.SCREEN_WIDTH,this.SCREEN_HEIGHT),this.css3dRenderer.domElement.style.position="absolute",this.css3dRenderer.domElement.style.top="0",this.css3dRenderer.domElement.style.left="0",$(this.css3dRenderer.domElement).addClass("css3d-container"),this.container.append(this.css3dRenderer.domElement),this.projector=new THREE.Projector,this.raycaster=new THREE.Raycaster,a=new THREE.SceneLoader,a.load(this.pageBase+"maya/data/scene2.json",this.sceneLoadCallback),$(window).bind("resize",this.onWindowResize),this.container.bind("mousemove touchmove touchstart",this.onMouseMove),this.container.bind("click touchend",this.on3DSceneMouseClick),this.container.bind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",this.onWindowResize),this.onWindowResize()},a.prototype.setupCSS3DPage=function(a,b,c){var d,e,f;return a.css({opacity:0,display:"none"}),d=new THREE.CSS3DObject(a[0]),d.rotation.order="ZYX",d.position.set(b.position.x*this.SCENE_SCALE_MULTIPLIER,b.position.y*this.SCENE_SCALE_MULTIPLIER,b.position.z*this.SCENE_SCALE_MULTIPLIER),d.quaternion.set(b.quaternion.x,b.quaternion.y,b.quaternion.z,b.quaternion.w),f=new THREE.Quaternion,f.setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),d.quaternion.multiply(f),d.scale.set(b.scale.x*this.PAGE_SCALE_MULTIPLIER,b.scale.y*this.PAGE_SCALE_MULTIPLIER,b.scale.z*this.PAGE_SCALE_MULTIPLIER),b.page=a,b.cssObj=d,this.css3DScene.add(d),e=c.split("/"),e[1]===this.pageLanguage&&e[2]===this.pagePermalink&&_.delay(function(a){return function(){return a.handlePushState(c)}}(this),1e3),null},a.prototype.showLoading=function(){return $(".javascriptContent").spin({lines:8,length:8,width:5,radius:11,corners:1,rotate:0,direction:1,color:"#444",speed:1.3,trail:60,shadow:!0,hwaccel:!0,className:"spinner",zIndex:2e9,top:"47%",left:"47%"})},a.prototype.hideLoading=function(){return $(".javascriptContent").spin(!1)},a.prototype.sceneLoadCallback=function(a){var b;return $(".page-container").css({display:"none"}),this.colors=paletteGenerator.generate(a.scene.children.length,function(a){var b;return b=a.hcl(),b[0]>=0&&b[0]<=360&&b[1]>=0&&b[1]<=.9&&b[2]>=1&&b[2]<=1.5},!1,50),this.colors=paletteGenerator.diffSort(this.colors),b=0,a.scene.traverse(function(a){return function(c){var d,e,f,g,h;return c.rotation.order="ZYX",c.material&&-1===a.excludeFromPicking.indexOf(c.name)&&(a.initialObjectsProperties[c.name]={},a.initialObjectsProperties[c.name].position=c.position.clone(),a.initialObjectsProperties[c.name].quaternion=c.quaternion.clone(),a.initialObjectsProperties[c.name].scale=c.scale.clone(),h=THREE.UniformsUtils.clone(THREE.PlaneShader.uniforms),h.focus_balance.value=0,h.ovelay_unfocused_alpha.value=1,h.opacity.value=1,h.diffuse.value.set(a.colors[b].rgb[0]/255,a.colors[b].rgb[1]/255,a.colors[b].rgb[2]/255),h.map.value=c.material.map,h.focused_map.value=THREE.ImageUtils.loadTexture(a.pageBase+"maya/images/focused.jpg"),h.overlay_map.value=THREE.ImageUtils.loadTexture(a.pageBase+"maya/images/overlay.png"),e={},e.USE_MAP="",g=new THREE.ShaderMaterial({uniforms:h,attributes:{},vertexShader:THREE.PlaneShader.vertexShader,fragmentShader:THREE.PlaneShader.fragmentShader,transparent:!0,lights:!1,fog:!1,shading:THREE.FlatShading,defines:e}),c.material=g,c.material.side=THREE.DoubleSide,null!=a.config[b]?(a.page3DObjects[a.config[b].link]=c,f=c.link=a.config[b].link,d=$("<div class='object3DContainer' permalink='"+f+"'></div>"),a.config[b].meta.permalink===a.pagePermalink&&d.append(a.htmlMain),a.setupCSS3DPage(d,c,f)):a.excludeFromPicking.push(c.name),b++),c.updateMatrix(),c.geometry?(c.geometry.computeFaceNormals(),c.geometry.computeVertexNormals(),c.geometry.computeCentroids(),c.geometry.computeTangents(),c.geometry.computeBoundingBox()):void 0}}(this)),this.scene=a.scene,this.scene.position.set(0,-450,0),this.css3DScene.position.set(0,-450,0),this.scene.scale.set(this.SCENE_SCALE_MULTIPLIER,this.SCENE_SCALE_MULTIPLIER,this.SCENE_SCALE_MULTIPLIER),this.scene.updateMatrix(),this.css3DScene.updateMatrix(),null},a.prototype.handleFocus=function(){return this.isFocused?this.overObject||this.unfocus():this.overObject&&(this.clickedObject=this.overObject,this.focus()),null},a.prototype.focus=function(){var a,b,c,d;return this.isFocused=!0,(c=this.clickedObject.page.find("main").length>0)?(this.hideLoading(),this.clickedObjectWPosition=this.initialObjectsProperties[this.clickedObject.name].position.clone(),this.clickedObjectWRotation=this.initialObjectsProperties[this.clickedObject.name].quaternion.clone(),this.clickedObjectWScale=this.initialObjectsProperties[this.clickedObject.name].scale.clone(),b=this.getFocusedPagePosition(),this.clickedObject.page.css({"pointer-events":"none"}),TweenMax.to(this.clickedObject.position,this.TRANSITION_DURATION,{x:b.x,y:b.y,z:b.z,onUpdateParams:[this.clickedObject],onCompleteParams:[this.clickedObject],onUpdate:function(a){return function(b){return b.cssObj.position.set(b.position.x*a.SCENE_SCALE_MULTIPLIER,b.position.y*a.SCENE_SCALE_MULTIPLIER,b.position.z*a.SCENE_SCALE_MULTIPLIER)}}(this),onComplete:function(){return function(a){return a.page.css({"pointer-events":""})}}(this)}),a=this.camera.quaternion.clone(),d=new THREE.Quaternion,d.setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2),a.multiply(d),TweenMax.to(this.clickedObject.quaternion,this.TRANSITION_DURATION,{x:a.x,y:a.y,z:a.z,w:a.w,onUpdateParams:[this.clickedObject],onUpdate:function(){return function(a){return a.cssObj.quaternion.set(a.quaternion.x,a.quaternion.y,a.quaternion.z,a.quaternion.w),d=new THREE.Quaternion,d.setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),a.cssObj.quaternion.multiply(d)}}(this)}),TweenMax.to(this.clickedObject.scale,this.TRANSITION_DURATION,{x:1,y:1,z:1,onUpdateParams:[this.clickedObject],onUpdate:function(a){return function(b){return b.cssObj.scale.set(b.scale.x*a.PAGE_SCALE_MULTIPLIER,b.scale.y*a.PAGE_SCALE_MULTIPLIER,b.scale.z*a.PAGE_SCALE_MULTIPLIER)}}(this)}),TweenMax.to(this.clickedObject.material.uniforms.focus_balance,this.TRANSITION_DURATION,{value:1}),this.clickedObject.page.css({display:"block"}),TweenMax.to(this.clickedObject.page[0],this.TRANSITION_DURATION,{css:{opacity:1}}),$(".close-page").show(),null):(this.showLoading(),void $.ajax(this.getRelativeLink(this.clickedObject.page.attr("permalink")),{success:function(a){return function(b){var c;return c=$(b).find("main"),a.clickedObject.page.append(c),a.focus()}}(this),error:function(){return function(a,b){return console.error(b)}}(this)}))},a.prototype.getFocusedPagePosition=function(){var a,b,c,d,e,f;return d=new THREE.Matrix4,d.makeRotationFromQuaternion(this.camera.quaternion),a=new THREE.Vector3(0,0,-1),a.applyMatrix4(d),a.normalize(),c=new THREE.Vector3(1,0,0),c.applyMatrix4(d),c.normalize(),f=65e-5*window.innerHeight,e=0,c.multiplyScalar(e),a.multiplyScalar(f),b=this.camera.position.clone(),b.x-=this.scene.position.x,b.y-=this.scene.position.y,b.z-=this.scene.position.z,b.x/=this.SCENE_SCALE_MULTIPLIER,b.y/=this.SCENE_SCALE_MULTIPLIER,b.z/=this.SCENE_SCALE_MULTIPLIER,b.add(c),b.add(a),b},a.prototype.unfocus=function(){return TweenMax.to(this.clickedObject.position,this.TRANSITION_DURATION,{x:this.clickedObjectWPosition.x,y:this.clickedObjectWPosition.y,z:this.clickedObjectWPosition.z,onComplete:function(a){return function(){return a.isFocused=!1}}(this),onUpdateParams:[this.clickedObject],onUpdate:function(a){return function(b){return b.cssObj.position.set(b.position.x*a.SCENE_SCALE_MULTIPLIER,b.position.y*a.SCENE_SCALE_MULTIPLIER,b.position.z*a.SCENE_SCALE_MULTIPLIER)}}(this)}),TweenMax.to(this.clickedObject.quaternion,this.TRANSITION_DURATION,{x:this.clickedObjectWRotation.x,y:this.clickedObjectWRotation.y,z:this.clickedObjectWRotation.z,w:this.clickedObjectWRotation.w,onUpdateParams:[this.clickedObject],onUpdate:function(){return function(a){var b;return a.cssObj.quaternion.set(a.quaternion.x,a.quaternion.y,a.quaternion.z,a.quaternion.w),b=new THREE.Quaternion,b.setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),a.cssObj.quaternion.multiply(b)}}(this)}),TweenMax.to(this.clickedObject.scale,this.TRANSITION_DURATION,{x:this.clickedObjectWScale.x,y:this.clickedObjectWScale.y,z:this.clickedObjectWScale.z,onUpdateParams:[this.clickedObject],onUpdate:function(a){return function(b){return b.cssObj.scale.set(b.scale.x*a.PAGE_SCALE_MULTIPLIER,b.scale.y*a.PAGE_SCALE_MULTIPLIER,b.scale.z*a.PAGE_SCALE_MULTIPLIER)}}(this)}),TweenMax.to(this.clickedObject.material.uniforms.focus_balance,this.TRANSITION_DURATION,{value:0}),TweenMax.to(this.clickedObject.page[0],this.TRANSITION_DURATION,{css:{opacity:0},onComplete:function(a){return function(){return a.clickedObject.page.css({display:"none"})}}(this)}),$(".close-page").hide(),null},a.prototype.onWindowResize=function(){var a,b,c;return this.CONTAINER_X=this.container.position().left,this.SCREEN_WIDTH=window.innerWidth-this.CONTAINER_X,this.SCREEN_HEIGHT=window.innerHeight,this.windowHalfX=this.SCREEN_WIDTH/2,this.windowHalfY=this.SCREEN_HEIGHT/2,this.camera.aspect=this.SCREEN_WIDTH/this.SCREEN_HEIGHT,this.camera.updateProjectionMatrix(),null!=(b=this.webglRenderer)&&b.setSize(this.SCREEN_WIDTH,this.SCREEN_HEIGHT),null!=(c=this.css3dRenderer)&&c.setSize(this.SCREEN_WIDTH,this.SCREEN_HEIGHT),this.isFocused?(a=this.getFocusedPagePosition(),this.clickedObject.position.set(a.x,a.y,a.z),this.clickedObject.cssObj.position.set(a.x*this.SCENE_SCALE_MULTIPLIER,a.y*this.SCENE_SCALE_MULTIPLIER,a.z*this.SCENE_SCALE_MULTIPLIER)):void 0},a.prototype.onMouseMove=function(a){var b,c,d,e;return this.isFocused||a.originalEvent.preventDefault(),b=a.clientX||(null!=(d=a.originalEvent.touches[0])?d.clientX:void 0),c=a.clientY||(null!=(e=a.originalEvent.touches[0])?e.clientY:void 0),this.mouseX=.5*(b-this.CONTAINER_X-this.windowHalfX),this.mouseY=.5*(c-this.windowHalfY),this.pickMouseX=(b-this.CONTAINER_X)/this.SCREEN_WIDTH*2-1,this.pickMouseY=2*-(c/this.SCREEN_HEIGHT)+1},a.prototype.animate=function(){return requestAnimationFrame(this.animate),this.render()},a.prototype.render=function(){var a,b,c,d;return this.isFocused||(this.camera.position.x+=.05*(this.mouseX-this.camera.position.x),this.camera.position.y+=.05*(-this.mouseY-this.camera.position.y),this.camera.position.y=Math.max(this.FLOOR,this.camera.position.y),this.camera.lookAt(this.cameraLookAt)),null!=(c=this.webglRenderer)&&c.render(this.scene,this.camera),null!=(d=this.css3dRenderer)&&d.render(this.css3DScene,this.camera),b=new THREE.Vector3(this.pickMouseX,this.pickMouseY,1),this.projector.unprojectVector(b,this.camera),this.raycaster.set(this.camera.position,b.sub(this.camera.position).normalize()),a=this.raycaster.intersectObjects(this.scene.children),this.doPicking&&(a.length>0?this.handlePicking(a[0].object):(this.overObject&&TweenMax.to(this.overObject.material.uniforms.ovelay_unfocused_alpha,1,{value:1}),this.overObject=null)),null==this.overObject||this.isFocused?$("body").css("cursor",""):$("body").css("cursor","pointer")},a.prototype.handlePicking=function(a){if(this.overObject!==a){if(this.overObject&&TweenMax.to(this.overObject.material.uniforms.ovelay_unfocused_alpha,1,{value:1}),-1!==this.excludeFromPicking.indexOf(a.name))return this.overObject=null;if(this.overObject=a,TweenMax.to(this.overObject.material.uniforms.ovelay_unfocused_alpha,1,{value:0}),!this.isFocused)return ga("send","event","3d-plane:"+this.overObject.link,"over")}},a.prototype.getUpDirs=function(a){var b,c,d;for(c="",b=d=0;a>d;b=d+=1)c+="../";return c},a.prototype.getRelativeLink=function(a){var b,c;return b=this.pageDepth,c=this.getUpDirs(b),b>0?c.substr(0,c.length-1)+a:"."+a},a.prototype.cleanupPathName=function(a){var b;return b=a.split("/"),"/"+b[b.length-3]+"/"+b[b.length-2]+"/"},a}(),$(document).ready(function(){return window.app=new a})}.call(this);